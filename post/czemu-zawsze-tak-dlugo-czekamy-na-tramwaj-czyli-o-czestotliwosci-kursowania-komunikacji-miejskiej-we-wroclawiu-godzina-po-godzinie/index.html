<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Czemu zawsze tak długo czekamy na tramwaj czyli o częstotliwości kursowania komunikacji miejskiej we Wrocławiu godzina po godzinie - Szychta w danych</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Czemu zawsze tak długo czekamy na tramwaj czyli o częstotliwości kursowania komunikacji miejskiej we Wrocławiu godzina po godzinie" />
<meta property="og:description" content="Dzisiaj pokażę jak, za pomocą R oraz pakietów ggmap, dplyr i animation, zwizualizować zmiany natężenia kursów tramwajów i autobusów w ciągu dnia. Co ciekawego, oprócz wrażeń estetycznych, można z tych rysunków wyciągnąć? Choćby to, że uwidaczniają one niezwykle duże natężenie kursowania tramwajów w ścisłym centrum, nawet poza godzinami szczytu. Ten fakt odpowiada, przynajmniej częściowo, na pytanie postawione w tytule dzisiejszego wpisu. Tramwaje częściej kursować nie mogą bo&hellip; nie ma na nie miejsca." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/czemu-zawsze-tak-dlugo-czekamy-na-tramwaj-czyli-o-czestotliwosci-kursowania-komunikacji-miejskiej-we-wroclawiu-godzina-po-godzinie/" />
<meta property="article:published_time" content="2015-02-22T19:13:41+00:00" />
<meta property="article:modified_time" content="2015-02-22T19:13:41+00:00" />

		<meta itemprop="name" content="Czemu zawsze tak długo czekamy na tramwaj czyli o częstotliwości kursowania komunikacji miejskiej we Wrocławiu godzina po godzinie">
<meta itemprop="description" content="Dzisiaj pokażę jak, za pomocą R oraz pakietów ggmap, dplyr i animation, zwizualizować zmiany natężenia kursów tramwajów i autobusów w ciągu dnia. Co ciekawego, oprócz wrażeń estetycznych, można z tych rysunków wyciągnąć? Choćby to, że uwidaczniają one niezwykle duże natężenie kursowania tramwajów w ścisłym centrum, nawet poza godzinami szczytu. Ten fakt odpowiada, przynajmniej częściowo, na pytanie postawione w tytule dzisiejszego wpisu. Tramwaje częściej kursować nie mogą bo&hellip; nie ma na nie miejsca.">
<meta itemprop="datePublished" content="2015-02-22T19:13:41+00:00" />
<meta itemprop="dateModified" content="2015-02-22T19:13:41+00:00" />
<meta itemprop="wordCount" content="657">



<meta itemprop="keywords" content="analiza danych,animacja,ggplot,mpk,R,transport,wizualizacja,Wrocław," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Czemu zawsze tak długo czekamy na tramwaj czyli o częstotliwości kursowania komunikacji miejskiej we Wrocławiu godzina po godzinie"/>
<meta name="twitter:description" content="Dzisiaj pokażę jak, za pomocą R oraz pakietów ggmap, dplyr i animation, zwizualizować zmiany natężenia kursów tramwajów i autobusów w ciągu dnia. Co ciekawego, oprócz wrażeń estetycznych, można z tych rysunków wyciągnąć? Choćby to, że uwidaczniają one niezwykle duże natężenie kursowania tramwajów w ścisłym centrum, nawet poza godzinami szczytu. Ten fakt odpowiada, przynajmniej częściowo, na pytanie postawione w tytule dzisiejszego wpisu. Tramwaje częściej kursować nie mogą bo&hellip; nie ma na nie miejsca."/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-121778161-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Szychta w danych" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Szychta w danych</div>
					<div class="logo__tagline">Blog o poznawaniu świata za pomocą danych</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/o-blogu/">
				
				<span class="menu__text">O blogu</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">O mnie</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/projects/">
				
				<span class="menu__text">Projekty</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/szkolenia-z-analizy-danych/">
				
				<span class="menu__text">Szkolenia z analizy danych</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Czemu zawsze tak długo czekamy na tramwaj czyli o częstotliwości kursowania komunikacji miejskiej we Wrocławiu godzina po godzinie</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Piotr Sobczyk</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2015-02-22T19:13:41Z">2015-02-22</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/r/" rel="category">R</a>, <a class="meta__link" href="/categories/wroc%C5%82aw/" rel="category">Wrocław</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents"></nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>Dzisiaj pokażę jak, za pomocą R oraz pakietów ggmap, dplyr i animation, zwizualizować zmiany natężenia kursów tramwajów i autobusów w ciągu dnia. Co ciekawego, oprócz wrażeń estetycznych, można z tych rysunków wyciągnąć? Choćby to, że uwidaczniają one niezwykle duże natężenie kursowania tramwajów w ścisłym centrum, nawet poza godzinami szczytu. Ten fakt odpowiada, przynajmniej częściowo, na pytanie postawione w tytule dzisiejszego wpisu. Tramwaje częściej kursować nie mogą bo&hellip; nie ma na nie miejsca. Właściwie wszystkie linie kursują przez ścisłe centrum miasta. Zupełnie inaczej ma się sprawa z autobusami.</p>
<!-- raw HTML omitted -->
<p>W <a href="https://szychtawdanych.wordpress.com/2015/02/19/jak-wyglada-komunikacja-miejska-we-wroclawiu/">poprzednim wpisie</a> pokazałem jak wygląda natężenie kursów mpk, ale nie napisałem zbyt dużo o kodzie eRowym. Tym razem oprócz nowych rysunków, animacji, pokażę dokładniej jak można je uzyskać w R.</p>
<p>Zobaczmy zatem jak wygląda natężenie kursów tramwajowych i autobusowych w dni robocze.
Oto pierwsza grafika:</p>
<p><a href="https://szychtawdanych.files.wordpress.com/2015/02/animacja_mpk2.gif"><img src="https://szychtawdanych.files.wordpress.com/2015/02/animacja_mpk2.gif?w=300" alt="animacja_mpk2"></a></p>
<p>Być może jest to kwestia złego doboru kolorów i skali przezroczystości, ale ten wykres wydaje mi się mało czytelny. Użycie jasnego koloru dla rejonów o wyższej intensywności, które było naturalnym wyborem dla wykresów z poprzedniego wpisu, w połączeniu z animacją, daje mi mylne intuicje. Być może jest to kwestia indywidualna, ale dla mnie każda zmiana koloru na ciemniejszy przykuwa uwagę. Wobec tego mimo, że kursów ubywa, ja mam wrażenie jakby trend był odwrotny. Spróbujemy temu zaradzić za pomocą nowego rysunku</p>
<p><a href="https://szychtawdanych.files.wordpress.com/2015/02/animacja_mpk4.gif"><img src="https://szychtawdanych.files.wordpress.com/2015/02/animacja_mpk4.gif?w=300" alt="animacja_mpk4"></a></p>
<p>Wydaje mi się, że jest on dużo bardziej przejrzysty od poprzedniego. Bardzo klarownie widać na nim zarówno rozjeżdżanie się tramwajów z i do zajezdni, jak i istotną redukcję liczby kursów w środku dnia. Ciekawy jest też rozkład kursowania autobusów nocnych, pokrywają one, mniej więcej jednostajnie, cały obszar miasta.</p>
<p>A teraz czas na pokazanie bebechów.</p>
<p><strong>Wczytywanie i przetwarzanie danych</strong></p>
<p>Do przetwarzania danych używam pakietu dplyr. Dla chcących poznać tajniki tego pakietu polecam <a href="http://www.rstudio.com/resources/cheatsheets/">ściągawkę</a> ze strony RStudio.</p>
<pre><code>przystanki dec=&quot;,&quot;, colClasses=c(&quot;numeric&quot;,&quot;numeric&quot;,&quot;numeric&quot;,&quot;factor&quot;),
col.names = c('lon', 'lat', 'id', 'type'))
levels(przystanki$type) %
filter(slupek %in% przystanki$id) %&gt;%
inner_join(przystanki, by = c(&quot;slupek&quot; = &quot;id&quot;)) -&gt; rozklady_przystanki
</code></pre>
<p>Zwracam uwagę na możliwość wykonywania operacji łączenia dwóch ramek danych, w taki sam sposób, jak robi się to z tabelami w SQLu.
Interesuje nas podział na linie tramwajowe i autobusowe</p>
<pre><code>tramwaje = factor(c('0L', '0P', '1', '10', '11', '14', '15', '17', '2', '20', '23', '24', '3', '31', '32', '33', '4', '5', '6', '7', '8', '9'),
levels = levels(rozklady_przystanki$linia))

rozklady_przystanki %&gt;%
filter(dzien==&quot;roboczy&quot;,
linia %in% tramwaje) %&gt;%
mutate(typ = &quot;tramwaj&quot;) %&gt;%
select(slupek, lon, lat, typ, godzina) %&gt;%
bind_rows(rozklady_przystanki %&gt;%
filter(dzien==&quot;roboczy&quot;,
! linia %in% tramwaje) %&gt;%
mutate(typ = &quot;autobus&quot;) %&gt;%
select(slupek, lon, lat, typ, godzina)) -&gt; rozklady_dzien_roboczy
</code></pre>
<p><strong>Tworzenie pierwszej animacji</strong></p>
<p>Animacje w R tworzę za pomocą pakietu <a href="http://cran.r-project.org/web/packages/animation/index.html">animation</a>.</p>
<pre><code>require(animation)
wroclaw = get_map(&quot;wrocław&quot;, color=&quot;bw&quot;, zoom = 12)
WroclawMap = ggmap(wroclaw, extent = &quot;device&quot;, legend = &quot;bottom&quot;)
godziny = 0:23
plot_mpk = function(){
for(i in 1:length(godziny)){
tytul = paste(&quot;Natężenie ruchu komunikacji miejskiej we Wrocławiunmiędzy godzinami&quot;,
paste(godziny[[i]], &quot;a&quot;, godziny[[i]]+1, collapse=&quot;,&quot;))
p = WroclawMap + stat_density2d(
aes(x = lon, y = lat, fill = ..level.., alpha =..level..),
size = 30, bins=20,
data = rozklady_dzien_roboczy %&gt;%
filter(godzina %in% godziny[[i]]),
geom = &quot;polygon&quot;) +
scale_alpha(range = c(.05, .3), guide = FALSE) +
scale_fill_gradient(&quot;Natężenienkomunikacjinmiejskiej&quot;, guide = &quot;colourbar&quot;,
limits=c(0, 800)) +
guides(fill = guide_colorbar(barwidth = 15, barheight = 1)) +
facet_grid(. ~typ) +
ggtitle(tytul) +
theme(plot.title=element_text(size=20, face=&quot;bold&quot;, colour=&quot;steelblue&quot;))
print(p)
}
}
oopt = ani.options(interval = 2, nmax = length(godziny), ani.width = 1100, ani.height = 700)
saveGIF(plot_mpk(), movie.name = &quot;nazwa_pliku.gif&quot;)
</code></pre>
<p>Tworzenie drugiej animacji</p>
<pre><code>WroclawMap = ggmap(wroclaw, extent = &quot;device&quot;, legend = &quot;bottomright&quot;)
godziny = 0:23
plot_mpk = function(){
for(i in 1:length(godziny)){
tytul = paste(&quot;Natężenie ruchu na przystankach komunikacji miejskiej we Wrocławiunmiędzy godzinami&quot;,
paste(godziny[[i]], &quot;a&quot;, godziny[[i]]+1, collapse=&quot;,&quot;))
p = WroclawMap +
geom_point(aes(x = lon, y = lat, color = typ, size = count, alpha =.4),
data = rozklady_dzien_roboczy %&gt;%
filter(godzina %in% godziny[[i]]) %&gt;%
group_by(slupek, lon, lat, typ) %&gt;%
summarise(count = n()) %&gt;%
select(lon, lat, typ, count)) +
scale_alpha(guide = FALSE) +
scale_color_discrete(&quot;Rodzaj przystanku&quot;) +
scale_size_area(&quot;Liczba połączeń na dobę&quot;, max_size = 15, limits=c(0, 100)) +
ggtitle(tytul) +
theme(plot.title=element_text(size=20, face=&quot;bold&quot;, colour=&quot;steelblue&quot;))
print(p)
}
}
oopt = ani.options(interval = 2, nmax = length(godziny), ani.width = 1000, ani.height = 1000)
saveGIF(plot_mpk(), movie.name = &quot;nazwa_pliku.gif&quot;)
</code></pre>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/analiza-danych/" rel="tag">analiza danych</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/animacja/" rel="tag">animacja</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/ggplot/" rel="tag">ggplot</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/mpk/" rel="tag">mpk</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/r/" rel="tag">R</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/transport/" rel="tag">transport</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/wizualizacja/" rel="tag">wizualizacja</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/wroc%C5%82aw/" rel="tag">Wrocław</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Piotr Sobczyk avatar" src="/Users/piotr/GitHub/blogdown-source/config_files/avatar.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Piotr Sobczyk</span>
	</div>
	<div class="authorbox__description">
		PhD, Data scientist
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/post/jak-wyglada-komunikacja-miejska-we-wroclawiu/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Jak wygląda komunikacja miejska we Wrocławiu?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/post/infografika-dotyczaca-wyborow-samorzadowych-i-co-z-niej-wynika/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Infografika dotycząca wyborów samorządowych i co z niej wynika</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "szychta" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Piotr Sobczyk.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>